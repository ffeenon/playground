(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[999],{4008:function(e,t,r){Promise.resolve().then(r.bind(r,5722))},5722:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return page}});var n=r(7437),u=r(8524),i=r(2265),s=r(2461),l=r(1500);let IsObject=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function useTexture(e,t){let r=(0,l.D)(e=>e.gl),n=(0,l.H)(s.dpR,IsObject(e)?Object.values(e):e);(0,i.useLayoutEffect)(()=>{null==t||t(n)},[t]),(0,i.useEffect)(()=>{if("initTexture"in r){let e=[];Array.isArray(n)?e=n:n instanceof s.xEZ?e=[n]:IsObject(n)&&(e=Object.values(n)),e.forEach(e=>{e instanceof s.xEZ&&r.initTexture(e)})}},[r,n]);let u=(0,i.useMemo)(()=>{if(!IsObject(e))return n;{let t={},r=0;for(let u in e)t[u]=n[r++];return t}},[e,n]);return u}useTexture.preload=e=>l.H.preload(s.dpR,e),useTexture.clear=e=>l.H.clear(s.dpR,e);var a=r(8252),o=r(2999);let c=function(e,t,r,n){let u=class extends s.jyz{constructor(u={}){let i=Object.entries(e);super({uniforms:i.reduce((e,[t,r])=>{let n=s.rDY.clone({[t]:{value:r}});return{...e,...n}},{}),vertexShader:t,fragmentShader:r}),this.key="",i.forEach(([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t})),Object.assign(this,u),n&&n(this)}};return u.key=s.M8C.generateUUID(),u}({uFilter:0,uBaseTexture:new s.xEZ,uFilterTexture:new s.xEZ,transparent:!0},"uniform float uFilter;\nvarying vec2 vUv;\n\nvoid main(){\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n    vUv = uv;\n}","uniform float uFilter;\nuniform sampler2D uBaseTexture;\nuniform sampler2D uFilterTexture;\nvarying vec2 vUv;\n\nvoid main() {\n    // version 1 使用if实现\n    //  if(texture2D(uFilterTexture, vUv).r >= uFilter){\n    //    gl_FragColor = texture2D(uBaseTexture, vUv);\n    //  }else{\n    //    gl_FragColor = vec4(0.0);\n    //  }\n\n    // version 2 出于性能考虑，避免使用分支，这里用step来代替\n    //  float filterValue = texture2D(uFilterTexture, vUv).r;\n    //  float mask = step(uFilter, filterValue); // step函数，>= 的情况下都是1\n    //  vec4 baseColor = texture2D(uBaseTexture, vUv);\n    //  gl_FragColor = baseColor*mask;\n\n    // versino 3 使用smoothstep和mix平滑插值\n    float filterValue = texture2D(uFilterTexture, vUv).r;\n    float mask = smoothstep(uFilter - 0.05, uFilter + 0.05, filterValue);\n    vec4 baseColor = texture2D(uBaseTexture, vUv);\n    vec4 transparentColor = vec4(baseColor.rgb, 0.0);\n    gl_FragColor = mix(transparentColor, baseColor, mask);\n}");(0,l.e)({CustomFilterMaterial:c});var FilterMaterial=e=>{let{filter:t,baseTexture:r,filterTexture:u}=e;return(0,n.jsx)("customFilterMaterial",{uFilter:t,uBaseTexture:r,uFilterTexture:u})};function Experience(){let{size:e,filter:t}=(0,o.M4)({size:{value:1,step:.1,min:.5,max:3},filter:{value:0,step:.01,min:0,max:1}}),[r,u]=useTexture(["/playground/_next/static/media/perlin.06cb3975.jpg","/tree_root.png"]);return(0,n.jsxs)("mesh",{children:[(0,n.jsx)("planeGeometry",{args:[e,e]}),(0,n.jsx)(FilterMaterial,{filter:t,baseTexture:u,filterTexture:r})]})}var page=()=>(0,n.jsxs)(u.Xz,{children:[(0,n.jsx)(a.z,{}),(0,n.jsx)("axesHelper",{args:[10]}),(0,n.jsx)(Experience,{})]})}},function(e){e.O(0,[870,689,151,10,971,472,744],function(){return e(e.s=4008)}),_N_E=e.O()}]);